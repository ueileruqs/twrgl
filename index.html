
```js
function createPlanilha(containerId, addBtnId, exportBtnId, exportFilename, isDecolagens = false) {
  let headers = [
    "INDICATIVO", "TIPO AERONAVE (ICAO)", "RWY ARR", "ORIGEM",
    "PASSOU FAF", "PASSOU CAB", "2400 M", "LIBEROU PISTA", "TWY", "OBSERVAÇÕES"
  ];

  if (isDecolagens) {
    headers = [
      "INDICATIVO", "TIPO AERONAVE (ICAO)", "RWY DEP", "DESTINO",
      "SAÍDA POS 2", "AERONAVE ALINHOU", "INICIOU ROLAGEM", "CRUZOU 2400 M",
      "CRUZOU CAB OPOSTA", "INICIOU CURVA", "PONTO CLR DEP", "OBSERVAÇÕES"
    ];
  }

  const localStorageKey = "dados_planilha_" + exportFilename;

  const conta = document.getElementById(containerId);
  const addLinhaBtn = document.getElementById(addBtnId);
  const exportBtn = document.getElementById(exportBtnId);

  conta.innerHTML = `
    <div class="overflow-x-auto rounded">
      <table class="w-full table-fixed border bg-white text-sm relative">
        <colgroup>
          ${headers.map(() => `<col class="min-w-[90px]" />`).join("\n")}
        </colgroup>
        <thead class="sticky top-0 z-10 bg-gray-200">
          <tr>
            ${headers.map(h => `<th class="border px-2 py-1">${h}</th>`).join('')}
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <div class="text-xs text-gray-400 mt-2 text-center">
      <ul>
        <li><b>RWY DEP</b>: lista suspensa (15, 33, 10, 28) na Decolagens.</li>
        <li><b>DESTINO</b>: auto-complete ICAO dos principais aeroportos do Brasil.</li>
        <li><b>TIPO AERONAVE (ICAO)</b>: preenchida pelo callsign se cadastrado, mas pode ser editada livremente.</li>
        <li>Duplo clique em qualquer célula insere data/hora em PT-BR (exceto INDICATIVO, OBSERVAÇÕES).</li>
        <li><b>PONTO CLR DEP</b>: lista suspensa com opções "POSIÇÃO 2" e "POSIÇÃO 3".</li>
      </ul>
    </div>
  `;

  const tbody = conta.querySelector("tbody");

  function saveData() {
    const rows = Array.from(tbody.getElementsByTagName('tr'));
    const result = [];
    rows.forEach(row => {
      const cells = Array.from(row.getElementsByTagName('td'));
      const rowData = cells.map((cell, idx) => {
        if (isDecolagens && idx === 10) {
          return cell.querySelector('select').value;
        } else if (idx === 2) {
          // RWY select for both tables
          return cell.querySelector('select').value;
        } else if (isDecolagens && idx === 11) {
          return cell.querySelector('input').value;
        } else {
          return cell.querySelector('input').value;
        }
      });
      result.push(rowData);
    });
    localStorage.setItem(localStorageKey, JSON.stringify(result));
  }

  function loadData() {
    const saved = localStorage.getItem(localStorageKey);
    if (saved) {
      try {
        const dataArray = JSON.parse(saved);
        if (Array.isArray(dataArray)) {
          // Limpa existente
          tbody.innerHTML = "";
          dataArray.forEach(dataRow => {
            addRow(dataRow);
          });
          return true;
        }
      } catch (e) {
        console.warn("Erro ao carregar dados salvos:", e);
      }
    }
    return false;
  }

  function addRow(data = Array(headers.length).fill("")) {
    const row = document.createElement('tr');

    // Cria as células e inputs como antes (resumo para não alongar)
    // INDICATIVO
    const indicativoCell = document.createElement('td');
    indicativoCell.className = "border px-2 py-1";
    const indicativoInput = document.createElement('input');
    indicativoInput.type = "text";
    indicativoInput.value = data[0] || "";
    indicativoInput.className = "w-full p-1 border-none outline-none bg-transparent uppercase";
    indicativoInput.onblur = checkAndFillType;
    indicativoInput.oninput = checkAndFillType;
    indicativoInput.oninput = saveData; // salva ao digitar
    indicativoCell.appendChild(indicativoInput);

    function checkAndFillType() {
      const val = indicativoInput.value.trim().toUpperCase();
      indicativoInput.value = val;
      if (!tipoInput.value.trim()) {
        tipoInput.value = callsignToICAO[val] || "";
      }
      saveData();
    }

    // TIPO AERONAVE (ICAO)
    const tipoCell = document.createElement('td');
    tipoCell.className = "border px-2 py-1";
    const tipoInput = document.createElement('input');
    tipoInput.type = "text";
    tipoInput.value = data[1] || "";
    tipoInput.className = "w-full p-1 border-none outline-none bg-transparent";
    tipoInput.oninput = saveData;
    tipoCell.appendChild(tipoInput);

    row.appendChild(indicativoCell);
    row.appendChild(tipoCell);

    // RWY select
    const rwyCell = document.createElement('td');
    rwyCell.className = "border px-2 py-1";
    const rwyOptions = ["", "15", "33", "10", "28"];
    const rwySelect = document.createElement('select');
    rwySelect.className = "w-full p-1 border rounded bg-white text-center";
    rwyOptions.forEach(optVal => {
      const opt = document.createElement('option');
      opt.value = optVal;
      opt.innerText = optVal;
      if (data[2] === optVal) opt.selected = true;
      rwySelect.appendChild(opt);
    });
    rwySelect.onchange = saveData;
    rwyCell.appendChild(rwySelect);
    row.appendChild(rwyCell);

    // ORIGEM / DESTINO autocomplete input
    const origemDestinoCell = document.createElement('td');
    origemDestinoCell.className = "border px-2 py-1 relative";
    const origemDestinoInput = document.createElement('input');
    origemDestinoInput.type = "text";
    origemDestinoInput.autocomplete = "off";
    origemDestinoInput.value = data[3] || "";
    origemDestinoInput.className = "w-full p-1 border-none outline-none bg-transparent uppercase";
    makeAutocomplete(origemDestinoInput, aeroportosICAO);
    origemDestinoInput.ondblclick = e => {
      e.preventDefault();
      origemDestinoInput.value = "";
      setTimeout(() => origemDestinoInput.focus(), 50);
    };
    origemDestinoInput.oninput = saveData;
    origemDestinoCell.appendChild(origemDestinoInput);
    row.appendChild(origemDestinoCell);

    if (!isDecolagens) {
      // POUSOS campos 4 a 8 inputs com duplo clique pra data/hora e 9 sem duplo clique
      for (let i = 4; i <= 8; i++) {
        const cell = document.createElement('td');
        cell.className = "border px-2 py-1";
        const input = document.createElement('input');
        input.type = "text";
        input.value = data[i] || "";
        input.className = "w-full p-1 border-none outline-none bg-transparent";
        input.ondblclick = e => {
          e.preventDefault();
          input.value = getBRDateTime();
          saveData();
        };
        input.oninput = saveData;
        cell.appendChild(input);
        row.appendChild(cell);
      }
      const obsCell = document.createElement('td');
      obsCell.className = "border px-2 py-1";
      const obsInput = document.createElement('input');
      obsInput.type = "text";
      obsInput.value = data[9] || "";
      obsInput.className = "w-full p-1 border-none outline-none bg-transparent";
      obsInput.oninput = saveData;
      obsCell.appendChild(obsInput);
      row.appendChild(obsCell);
    } else {
      // DECOLAGENS campos 4 a 9 inputs, 10 select, 11 input obs
      const createDCellWithDate = (val) => {
        const cell = document.createElement('td');
        cell.className = "border px-2 py-1";
        const input = document.createElement('input');
        input.type = "text";
        input.value = val || "";
        input.className = "w-full p-1 border-none outline-none bg-transparent";
        input.ondblclick = e => {
          e.preventDefault();
          input.value = getBRDateTime();
          saveData();
        };
        input.oninput = saveData;
        cell.appendChild(input);
        return cell;
      };
      row.appendChild(createDCellWithDate(data[4]));
      row.appendChild(createDCellWithDate(data[5]));
      row.appendChild(createDCellWithDate(data[6]));
      row.appendChild(createDCellWithDate(data[7]));
      row.appendChild(createDCellWithDate(data[8]));
      row.appendChild(createDCellWithDate(data[9]));

      // PONTO CLR DEP select
      const pontoClrDepCell = document.createElement('td');
      pontoClrDepCell.className = "border px-2 py-1";
      const pontoClrDepSelect = document.createElement('select');
      pontoClrDepSelect.className = "w-full p-1 border rounded bg-white text-center";
      ["", "POSIÇÃO 2", "POSIÇÃO 3"].forEach(optVal => {
        const opt = document.createElement('option');
        opt.value = optVal;
        opt.innerText = optVal;
        if(data[10] === optVal) opt.selected = true;
      pontoClrDepSelect.appendChild(opt);
      });
      pontoClrDepSelect.onchange = saveData;
      pontoClrDepCell.appendChild(pontoClrDepSelect);
      row.appendChild(pontoClrDepCell);

      // OBSERVAÇÕES
      const obsCell = document.createElement('td');
      obsCell.className = "border px-2 py-1";
      const obsInput = document.createElement('input');
      obsInput.type = "text";
      obsInput.value = data[11] || "";
      obsInput.className = "w-full p-1 border-none outline-none bg-transparent";
      obsInput.oninput = saveData;
      obsCell.appendChild(obsInput);
      row.appendChild(obsCell);
    }

    tbody.appendChild(row);
    return row;
  }

  // Ao carregar, tenta carregar do localStorage, senão cria 60 linhas vazias
  if (!loadData()) {
    for(let i=0; i<60; i++) addRow();
  }

  addLinhaBtn.onclick = () => {
    let firstNewRow = null;
    for(let i=0; i<100; i++) {
      const newRow = addRow();
      if(!firstNewRow) firstNewRow = newRow;
    }
    if(firstNewRow) firstNewRow.scrollIntoView({behavior:'smooth', block:'nearest'});
    saveData();
  };

  exportBtn.onclick = function() {
    const rows = Array.from(tbody.getElementsByTagName('tr'));
    const result = [headers];
    rows.forEach(row => {
      const cells = Array.from(row.getElementsByTagName('td'));
      const rowData = cells.map((cell, idx) => {
        if (isDecolagens && idx === 10) {
          return cell.querySelector('select').value;
        }
        else if (idx === 2) {
          return cell.querySelector('select').value;
        } else if (isDecolagens && idx === 11) {
          return cell.querySelector('input').value;
        } else {
          return cell.querySelector('input').value;
        }
      });
      result.push(rowData);
    });

    const ws = XLSX.utils.aoa_to_sheet(result);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, exportFilename);
    XLSX.writeFile(wb, exportFilename + ".xlsx");
  };
}
```
